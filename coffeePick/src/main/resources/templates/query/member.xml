<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.cp.user.member.dao.MemberDAO">

	<resultMap id="memberMap" type="member">
		<id column="member_id" property="member_id" />
		<result column="member_name" property="member_name" />
		<result column="member_nickname" property="member_nickname" />
		<result column="member_email" property="member_email" />
		<result column="member_addr" property="member_addr" />
		<result column="member_phone" property="member_phone" />
		<result column="member_status" property="member_status" />
		<result column="member_regdate" property="member_regdate" />

		<association property="point">
			<result column="member_id" property="member_id" />
			<result column="point_total" property="point_total" />
		</association>

		<association property="pickmoney">
			<result column="member_id" property="member_id" />
			<result column="pickmoney_total" property="pickmoney_total" />
		</association>
	</resultMap>


	<select id="memberList" resultMap="memberMap" parameterType="member">
		SELECT
			m.member_id as member_id, member_name, member_nickname, member_email,
			nvl(point_total,0) as point_total,
			member_addr, member_phone, member_status, TO_CHAR(member_regdate,'YYYY-MM-DD') as
			member_regdate, nvl(pickmoney_total,0) as pickmoney_total
		FROM member m
		LEFT JOIN point pt
		ON m.member_id = pt.member_id
		LEFT JOIN pickmoney pm
		ON pt.member_id = pm.member_id
		<!-- <where>
			<trim prefix="AND" prefixOverrides="AND">
				<if test="search=='member_id'">
					<![CDATA[m.member_id LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_name'">
					<![CDATA[member_name LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_nickname'">
					<![CDATA[member_nickname LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_email'">
					<![CDATA[member_email LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_addr'">
					<![CDATA[member_addr LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_phone'">
					<![CDATA[member_phone LIKE '%' || #{keyword} || '%']]>
				</if>
			</trim>
		</where> -->

<!-- <where>
			<trim prefix="AND" prefixOverrides="AND">
				<if test="search=='member_id'">
					<![CDATA[m.member_id LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_name'">
					<![CDATA[member_name LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_nickname'">
					<![CDATA[member_nickname LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_email'">
					<![CDATA[member_email LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_addr'">
					<![CDATA[member_addr LIKE '%' || #{keyword} || '%']]>
				</if>
				<if test="search=='member_phone'">
					<![CDATA[member_phone LIKE '%' || #{keyword} || '%']]>
				</if>
			</trim>
		</where> -->

		<where>
			
	
					<!-- 가입 날짜 범위 -->
					<if test="searchDate == 'joinDate'">
						member_regdate BETWEEN TO_DATE(#{start_date},'YYYY-MM-DD') AND TO_DATE(#{end_date},'YYYY-MM-DD')+1
					</if>
	
					
			</where>

	</select>

	<update id="memberStatus" parameterType="member">
		UPDATE member
		SET member_status = 'N'
		WHERE member_id=#{member_id}
	</update>

	<select id="memberCount" resultType="int">
		SELECT count(*) FROM member WHERE member_status='Y'
	</select>

</mapper>